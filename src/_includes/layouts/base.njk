<!DOCTYPE html>
<html lang="{{ lang }}" dir="{{ translations.dir or 'ltr' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    {# Page Title #}
    <title>{{ title }}{{ site.seo.titleSeparator }}{{ site.name }}</title>

    {# Meta Description #}
    <meta name="description" content="{{ description or translations.meta.defaultDescription }}">
    <meta name="keywords" content="{{ keywords or translations.meta.keywords }}">

    {# Canonical URL #}
    <link rel="canonical" href="{{ site.url }}{{ page.url }}">

    {# Hreflang Tags for Multi-language SEO #}
    {% if lang == 'tr' %}
    <link rel="alternate" hreflang="tr" href="{{ site.url }}{{ page.url }}">
    <link rel="alternate" hreflang="en" href="{{ site.url }}/en{{ page.url | replace('/tr', '') }}">
    <link rel="alternate" hreflang="x-default" href="{{ site.url }}{{ page.url }}">
    {% else %}
    <link rel="alternate" hreflang="en" href="{{ site.url }}{{ page.url }}">
    <link rel="alternate" hreflang="tr" href="{{ site.url }}{{ page.url | replace('/en', '') | replace('//', '/') }}">
    <link rel="alternate" hreflang="x-default" href="{{ site.url }}{{ page.url | replace('/en', '') | replace('//', '/') }}">
    {% endif %}

    {# Open Graph Meta Tags #}
    <meta property="og:title" content="{{ title }}{{ site.seo.titleSeparator }}{{ site.name }}">
    <meta property="og:description" content="{{ description or translations.meta.defaultDescription }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ site.url }}{{ page.url }}">
    <meta property="og:image" content="{{ ogImage or site.url ~ site.seo.defaultImage }}">
    <meta property="og:locale" content="{{ translations.locale }}">
    <meta property="og:site_name" content="{{ site.name }}">

    {# Twitter Card Meta Tags #}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="{{ site.seo.twitterHandle }}">
    <meta name="twitter:title" content="{{ title }}{{ site.seo.titleSeparator }}{{ site.name }}">
    <meta name="twitter:description" content="{{ description or translations.meta.defaultDescription }}">
    <meta name="twitter:image" content="{{ ogImage or site.url ~ site.seo.defaultImage }}">

    {# Favicon #}
    <link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg">
    <link rel="icon" type="image/x-icon" href="{{ site.favicon or '/assets/images/favicon.ico' }}">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon.svg">

    {# Preconnect for performance #}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    {# Google Fonts - Inter #}
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    {# Tailwind CSS via CDN (for development) #}
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': {
                            DEFAULT: '#1e40af',
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        'accent': {
                            DEFAULT: '#10b981',
                            green: '#10b981',
                        },
                        'dark': {
                            DEFAULT: '#0f172a',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    {# Custom Styles #}
    <link rel="stylesheet" href="/assets/css/styles.css">

    {# Additional head content from pages #}
    {% block head %}{% endblock %}

    {# JSON-LD Structured Data #}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "{{ site.name }}",
        "url": "{{ site.url }}",
        "logo": "{{ site.url }}/assets/images/materix-logo.svg",
        "description": "{{ translations.meta.defaultDescription }}",
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "{{ site.contact.address.street }}",
            "addressLocality": "{{ site.contact.address.city }}",
            "addressCountry": "TR"
        },
        "contactPoint": {
            "@type": "ContactPoint",
            "telephone": "{{ site.contact.phone }}",
            "email": "{{ site.contact.email }}",
            "contactType": "customer service",
            "availableLanguage": ["Turkish", "English"]
        },
        "sameAs": [
            "{{ site.social.linkedin }}",
            "{{ site.social.instagram }}"
        ]
    }
    </script>
    {% if schemaType == 'product' %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Product",
        "name": "{{ title }}",
        "description": "{{ description }}",
        "brand": {
            "@type": "Brand",
            "name": "MATERIX"
        },
        "manufacturer": {
            "@type": "Organization",
            "name": "{{ site.name }}"
        },
        "offers": {
            "@type": "Offer",
            "priceCurrency": "{% if lang == 'tr' %}TRY{% else %}EUR{% endif %}",
            "availability": "https://schema.org/InStock"
        }
    }
    </script>
    {% endif %}
</head>
<body class="bg-white text-gray-900 antialiased font-sans">
    {# Skip to main content for accessibility #}
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary text-white px-4 py-2 rounded z-50">
        {% if lang == 'tr' %}Ana içeriğe geç{% else %}Skip to main content{% endif %}
    </a>

    {# Header / Navigation #}
    {% include "components/header.njk" %}

    {# Main Content #}
    <main id="main-content">
        {% block content %}
        {{ content | safe }}
        {% endblock %}
    </main>

    {# Footer #}
    {% include "components/footer.njk" %}

    {# Netlify Identity Widget - handles login/signup/password reset #}
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.on("login", () => {
                        document.location.href = "/admin/";
                    });
                }
            });
        }
    </script>

    {# Main JavaScript #}
    <script src="/assets/js/main.js" defer></script>

    {# Additional scripts from pages #}
    {% block scripts %}{% endblock %}

    {# Cookie Consent Banner #}
    <div id="cookie-consent" class="fixed bottom-0 left-0 right-0 bg-gray-900 text-white p-4 z-50 transform translate-y-full transition-transform duration-300" style="display: none;">
        <div class="max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4">
            <p class="text-sm text-gray-300">
                {% if lang == 'tr' %}
                    Bu web sitesi deneyiminizi geliştirmek için çerezler kullanmaktadır. Sitemizi kullanarak çerez politikamızı kabul etmiş olursunuz.
                    <a href="/tr/gizlilik-politikasi/" class="underline text-cyan-400 hover:text-cyan-300">Daha fazla bilgi</a>
                {% else %}
                    This website uses cookies to enhance your experience. By using our site, you accept our cookie policy.
                    <a href="/en/privacy-policy/" class="underline text-cyan-400 hover:text-cyan-300">Learn more</a>
                {% endif %}
            </p>
            <div class="flex gap-3">
                <button onclick="acceptCookies()" class="px-6 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold text-sm transition-colors">
                    {% if lang == 'tr' %}Kabul Et{% else %}Accept{% endif %}
                </button>
                <button onclick="declineCookies()" class="px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-semibold text-sm transition-colors">
                    {% if lang == 'tr' %}Reddet{% else %}Decline{% endif %}
                </button>
            </div>
        </div>
    </div>

    <script>
        // Cookie consent functionality
        function showCookieConsent() {
            const banner = document.getElementById('cookie-consent');
            if (!localStorage.getItem('cookieConsent')) {
                banner.style.display = 'block';
                setTimeout(() => banner.classList.remove('translate-y-full'), 100);
            }
        }
        function acceptCookies() {
            localStorage.setItem('cookieConsent', 'accepted');
            hideBanner();
        }
        function declineCookies() {
            localStorage.setItem('cookieConsent', 'declined');
            hideBanner();
        }
        function hideBanner() {
            const banner = document.getElementById('cookie-consent');
            banner.classList.add('translate-y-full');
            setTimeout(() => banner.style.display = 'none', 300);
        }
        document.addEventListener('DOMContentLoaded', showCookieConsent);
    </script>
</body>
</html>
